define("block_novelties_notices/index",["exports","block_novelties_notices/repository","core/ajax"],(function(_exports,Repository,_ajax){var obj;function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,Repository=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(Repository),_ajax=(obj=_ajax)&&obj.__esModule?obj:{default:obj};_exports.init=()=>{new Vue({el:"#block_novelties_notices",vuetify:new Vuetify,data:{loading:!0,novelties:null,alertsConfigs:null,alerts:[],langKeys:[],dataToRender:[],tab:null},methods:{async getLangsKey(){var langskeys=null;if(M.hasOwnProperty("plugins"))langskeys=M.plugins.courseView.langsKeys;else{var response=await _ajax.default.call([{methodname:"local_alerts_front_get_langs",args:{}}])[0];langskeys=JSON.parse(response.lang)}this.langKeys=langskeys},async getNovelties(){let args={course_id:1==M.cfg.courseId?null:M.cfg.courseId},novelties=await Repository.getNovelties(args);for(let i=0;i<novelties.length;i++)novelties[i].is_active=0===i,novelties[i].is_novelty=!0;this.novelties=novelties},async getAlertsConfigs(){var configskeys=null;if(M.hasOwnProperty("plugins"))configskeys=M.plugins.courseView.configs.configs?JSON.parse(M.plugins.courseView.configs.configs):M.plugins.courseView.configs;else{var response=await _ajax.default.call([{methodname:"local_alerts_front_get_configs",args:{userid:M.cfg.contextInstanceId}}])[0];configskeys=JSON.parse(response.configs)}this.alertsConfigs=configskeys},async getAlerts(){var params=new URLSearchParams;params.set("userid",this.alertsConfigs.user_id),params.set("institution",this.alertsConfigs.institution),params.set("modality",this.alertsConfigs.modality),params.set("courseid",M.cfg.courseId);var fetchurl="".concat(this.alertsConfigs.urlapi,"/notices?").concat(params.toString()),response=await fetch("".concat(fetchurl)).catch((function(){}));void 0!==response&&404!==response.status&&(this.alerts=await response.json())},orderTopics(){if(this.dataToRender.length>0){const orderTopics=["forum_news","overdue_activities","activities_course_soon_close","corrected_activities","direct_response_forum","new_activities","direct_message_teacher"],objetoOrdenado=this.dataToRender.sort(((a,b)=>orderTopics.indexOf(a.abbreviation)-orderTopics.indexOf(b.abbreviation)));this.dataToRender=objetoOrdenado}},fusionAlertAndNovelties(){this.dataToRender=this.alerts,this.dataToRender=this.dataToRender.concat(this.novelties)},cleanDataToRender(){var newRenderBase=[];for(let i=0;i<this.dataToRender.length;i++){let element=this.dataToRender[i];var object={};object.abbreviation=element.abbreviation,object.count=element.count||element.count_notices,object.description=this.getDescriptionString(element),object.icon=element.icon,object.id=element.id,object.permanent=element.is_permanent||!1,object.langkey=element.lang_key,object.isNovelty=element.is_novelty||!1,object.notices=element.notices||element.novelties,object.name=this.getGroupTitle(object,element);var arraynoticesmapped=[];for(let j=0;j<object.notices.length;j++){var elementnotices=object.notices[j],noticesObj={};noticesObj.id=elementnotices.id,noticesObj.title=this.getTitleString(elementnotices,element),noticesObj.detail=this.getDetailString(elementnotices,element),noticesObj.icon=this.getIcon(elementnotices,element),noticesObj.viewed=elementnotices.is_view,noticesObj.url=elementnotices.url||!1,arraynoticesmapped.push(noticesObj)}object.notices=arraynoticesmapped,object.count>0&&newRenderBase.push(object)}this.dataToRender=newRenderBase},getGroupTitle(object,elementParent){return object.isNovelty?elementParent.name:this.langKeys[elementParent.lang_key]},getDetailCounter:(element,elementParent)=>!elementParent.is_novelty&&element.title.value,getIcon:(element,elementParent)=>elementParent.is_novelty?element.icon:elementParent.icon,getDescriptionString(element){return"lang.ac_son_close_desc"===element.description?this.langKeys.about_to_close_block_description:"lang.overdue_activities_desc"===element.description?this.langKeys.overdue_activity_block_description:"lang.ac_direct_message_desc"===element.description?this.langKeys.not_read_message_block_description:element.is_novelty?element.description:""},getTitleString:(element,elementParent)=>elementParent.is_novelty?element.title:element.detail,getDetailString(element,elementParent){return elementParent.is_novelty?"".concat(element.message):"".concat(this.langKeys[element.title.lang_key]," ").concat(element.title.value)},getIconImage:element=>M.util.image_url(element.icon.key,element.icon.component),async markasview(element,elementParent){var error=!1;if(!elementParent.permanent){if(elementParent.isNovelty){let args={novelty_id:element.id,type_novelty:elementParent.abbreviation};(await Repository.markedAsRead(args)).is_view||(error=!0)}else{var fetchUrl="".concat(this.alertsConfigs.urlapi,"/notices/").concat(element.id,"/marked-viewed");204!==(await fetch(fetchUrl,{method:"PUT"})).status&&(error=!0)}if(!error){var indexParent=this.dataToRender.findIndex((x=>x.abbreviation===elementParent.abbreviation));if(indexParent>-1){var indexNotices=this.dataToRender[indexParent].notices.findIndex((x=>x.id===element.id));this.dataToRender[indexParent].notices.splice(indexNotices,1),0===this.dataToRender[indexParent].notices.length&&this.dataToRender.splice(indexParent,1)}}}}},mounted:async function(){this.loading=!0,await this.getLangsKey(),await this.getNovelties(),await this.getAlertsConfigs(),await this.getAlerts(),await this.fusionAlertAndNovelties(),await this.cleanDataToRender(),this.orderTopics(),this.loading=!1},template:'\n        <v-app>\n            <v-main>\n                <div v-if="loading">\n                    <v-card min-height="200" elevation="0" loading></v-card>\n                </div>\n                <div v-else>\n                    <div v-if="dataToRender.length == 0">\n                        vista vacia\n                    </div>\n                    <div v-else>\n                        <v-tabs center-active show-arrows v-model="tab" grow>\n                            <v-tab v-for="i in dataToRender" :key="i.abbreviation">\n                                <span class="text-capitalize">{{i.name}}</span>\n                                <v-badge inline :content="i.notices.length">\n                                </v-badge>\n                            </v-tab>\n                        </v-tabs>\n                        <v-divider class="ma-0"></v-divider>\n                        <v-tabs-items v-model="tab">\n                            <v-tab-item v-for="i in dataToRender" :key="i.abbreviation">\n                                <div class="pt-2">\n                                    <div class="font-weight-bold">\n                                        {{i.description}}\n                                    </div>\n                                    <div class="my-2 mx-1" style="max-height: 190px; overflow-y: auto;">\n                                        <v-hover v-slot="{ hover }" v-for="j in i.notices" :key="j.id">\n                                            <v-card class="mb-1 mr-1 d-flex pa-2" flat :color="hover ? \'#f8f9fa\' : \'\'">\n                                                <div class="d-flex flex-grow-1">\n                                                    <a :href="j.url ? j.url:\'#\'" class="d-flex flex-grow-1">\n                                                        <div class="d-flex align-center">\n                                                            <div v-if="i.isNovelty" class="activityiconcontainer \n                                                                assessment \n                                                                collaboration \n                                                                icon_novelties_alerts\n                                                                pa-1\n                                                                courseicon mr-3" :class="j.purpose">\n                                                                <v-img :src="getIconImage(j)" class="activityicon"></v-img>\n                                                            </div>\n                                                            <div class="activityiconcontainer\n                                                            assessment\n                                                            collaboration\n                                                            icon_novelties_alerts\n                                                            pa-1\n                                                            courseicon mr-3 activityicon\n                                                            " v-else v-html="j.icon">\n                                                            </div>\n                                                        </div>\n                                                        <div>\n                                                            <div v-html="j.title" class="\n                                                                font-weight-bold\n                                                                primary--text\n                                                            "></div>\n                                                            <div v-html="j.detail" class="\n                                                                d-flex align-center \n                                                                font-weight-medium\n                                                                primary--text\n                                                                text-body-2\n                                                            "></div>\n                                                        </div>\n                                                    </a>\n                                                </div>\n                                                <div v-if="!i.permanent" class="d-flex align-center justify-center"\n                                                    style="text-decoration: none">\n                                                    <v-btn icon @click="markasview(j,i)">\n                                                        <v-icon>\n                                                            mdi-eye\n                                                        </v-icon>\n                                                    </v-btn>\n                                                </div>\n                                            </v-card>\n                                        </v-hover>\n                                    </div>\n                                </div>\n                            </v-tab-item>\n                        </v-tabs-items>                    \n                    </div>\n                </div>\n            </v-main>\n        </v-app>\n        '})}}));

//# sourceMappingURL=index.min.js.map