define("block_novelties_notices/index",["exports","block_novelties_notices/repository","core/ajax"],(function(_exports,Repository,_ajax){var obj;function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,Repository=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(Repository),_ajax=(obj=_ajax)&&obj.__esModule?obj:{default:obj};_exports.init=()=>{new Vue({el:"#block_novelties_notices",vuetify:new Vuetify,data:{novelties:null,alertsConfigs:null,alerts:null,langKeys:[],topicsToRender:[],containerToRender:[],tab:null},methods:{async getLangsKey(){var langskeys=null;if(M.hasOwnProperty("plugins"))langskeys=M.plugins.courseView.langsKeys;else{var response=await _ajax.default.call([{methodname:"local_alerts_front_get_langs",args:{}}])[0];langskeys=JSON.parse(response.lang)}this.langKeys=langskeys},async getNovelties(){let args={course_id:1==M.cfg.courseId?null:M.cfg.courseId},novelties=await Repository.getNovelties(args);for(let i=0;i<novelties.length;i++)novelties[i].is_active=0===i,novelties[i].is_novelty=!0;this.novelties=novelties},async getAlertsConfigs(){var configskeys=null;if(M.hasOwnProperty("plugins"))configskeys=M.plugins.courseView.configs;else{var response=await _ajax.default.call([{methodname:"local_alerts_front_get_configs",args:{userid:M.cfg.contextInstanceId}}])[0];configskeys=JSON.parse(response.configs)}this.alertsConfigs=configskeys},async getAlerts(){var params=new URLSearchParams;params.set("userid",this.alertsConfigs.user_id),params.set("institution",this.alertsConfigs.institution),params.set("modality",this.alertsConfigs.modality),params.set("courseid",M.cfg.courseId);var fetchurl="".concat(this.alertsConfigs.urlapi,"/notices?").concat(params.toString()),response=await fetch("".concat(fetchurl)).catch((function(){}));void 0!==response&&404!==response.status&&(this.alerts=await response.json())},async mapTabsTopics(){var containerToRender=[],mappedTopicsNovelties=this.novelties.map((function(e){var topicObj={};return topicObj.abbreviation=e.abbreviation,topicObj.name=e.name,topicObj.count=e.novelties.length,topicObj}));if(void 0!==this.alerts){let mappedTopicsAlerts=[];for(let i=0;i<this.alerts.length;i++){let e=this.alerts[i];if(e.notices.length){var topicObj={};topicObj.abbreviation=e.abbreviation,topicObj.name=this.langKeys[e.lang_key],topicObj.count=e.notices.length,topicObj.permanent="dimisible",topicObj.isPermanent=!1,mappedTopicsAlerts.push(topicObj)}}let mappedAlertToNovelties=[];for(let i=0;i<this.alerts.length;i++){let e=this.alerts[i];if(e.count_notices>0){var alertsObj={};alertsObj.abbreviation=e.abbreviation,alertsObj.name=this.langKeys[e.notices[0].title.lang_key],alertsObj.count=e.notices.length,alertsObj.id=e.id,"lang.ac_son_close"===e.lang_key?alertsObj.description=this.langKeys.about_to_close_block_description:"lang.overdue_activities"===e.lang_key?alertsObj.description=this.langKeys.overdue_activity_block_description:"lang.ac_direct_message"===e.lang_key?alertsObj.description=this.langKeys.not_read_message_block_description:alertsObj.description="Description not found",alertsObj.novelties=e.notices,alertsObj.icon=e.icon,alertsObj.type="alert",alertsObj.permanent=e.is_permanent?"permanent":"dimisible",alertsObj.isPermanent=e.is_permanent,mappedAlertToNovelties.push(alertsObj)}}var topics=await this.orderTopics(mappedTopicsNovelties,mappedTopicsAlerts);this.topicsToRender=topics,containerToRender=this.novelties.concat(mappedAlertToNovelties)}else this.topicsToRender=mappedTopicsNovelties,containerToRender=this.novelties;this.containerToRender=containerToRender},orderTopics(noveltiesTopic,alertsTopic){const orderTopics=["forum_news","overdue_activities","activities_course_soon_close","corrected_activities","direct_response_forum","new_activities","direct_message_teacher"];var actualTopics=noveltiesTopic.concat(alertsTopic);return(actualTopics=actualTopics.filter((n=>n))).sort(((a,b)=>orderTopics.indexOf(a.abbreviation)-orderTopics.indexOf(b.abbreviation)))}},mounted:async function(){await this.getLangsKey(),await this.getNovelties(),await this.getAlertsConfigs(),await this.getAlerts(),this.mapTabsTopics()},template:'\n            <v-app>\n                <v-main>\n                    <v-tabs center-active show-arrows v-model="tab">\n                        <v-tab v-for="i in topicsToRender" :key="i.abbreviation">\n                            {{i.name}}\n                            <v-badge inline :content="i.count">\n                            </v-badge>\n                        </v-tab>\n                    </v-tabs>\n                    \n                    <v-tabs-items v-model="tab">\n                        <v-tab-item v-for="i in containerToRender">\n                            {{i}}\n                        </v-tab-item>\n                    </v-tabs-items>\n                </v-main>\n            </v-app>\n        '})}}));

//# sourceMappingURL=index.min.js.map